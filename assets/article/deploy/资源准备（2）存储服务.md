# 对象存储服务准备指南

对象存储（OSS）用于存储博客的图片、视频、附件等静态资源，具有高可用、高扩展、低成本的特点。

## 为什么需要对象存储

### 传统存储 vs 对象存储

| 对比项  | 传统存储（服务器磁盘） | 对象存储（OSS）       |
|------|-------------|-----------------|
| 容量   | 受限于磁盘大小     | 无限扩展            |
| 成本   | 固定成本        | 按量付费，成本更低       |
| 可靠性  | 单点故障风险      | 多副本，99.9999999% |
| 访问速度 | 受服务器带宽限制    | CDN 加速，全球访问快    |
| 维护   | 需要自己维护      | 云服务商维护          |

### 使用场景

- ✅ 图片存储（文章配图、用户头像）
- ✅ 视频存储（视频教程、演示视频）
- ✅ 文件下载（软件包、文档）
- ✅ 静态资源（CSS、JS、字体文件）
- ✅ 数据备份（数据库备份、日志归档）

## 服务商选择

### 国内服务商对比

| 服务商 | 免费额度                   | 价格（存储）      | 价格（流量）   | CDN | 适合场景  |
|-----|------------------------|-------------|----------|-----|-------|
| 七牛云 | 10GB 存储 + 10GB 流量      | 0.148元/GB/月 | 0.29元/GB | 优秀  | 个人博客  |
| 阿里云 | 无                      | 0.12元/GB/月  | 0.5元/GB  | 优秀  | 企业应用  |
| 腾讯云 | 50GB 存储 + 10GB 流量（6个月） | 0.118元/GB/月 | 0.5元/GB  | 优秀  | 个人/企业 |
| 又拍云 | 10GB 存储 + 15GB 流量      | 0.12元/GB/月  | 0.29元/GB | 优秀  | 图片存储  |

### 推荐选择

**个人博客（推荐七牛云）**

- ✅ 免费额度充足（10GB 存储 + 10GB 流量/月）
- ✅ 价格便宜
- ✅ CDN 加速效果好
- ✅ 支持 HTTPS
- ✅ 适合 Golang 开发（官方 SDK）

**企业应用（推荐阿里云/腾讯云）**

- ✅ 服务稳定可靠
- ✅ 功能丰富
- ✅ 技术支持完善
- ✅ 与其他云服务集成好

## 七牛云配置（推荐）

### 1. 注册账号

访问 [七牛云官网](https://portal.qiniu.com/) 注册账号并完成实名认证。

## 七牛云配置

### 1. 创建存储空间

访问 [七牛云控制台](https://portal.qiniu.com/kodo/bucket)

- 存储空间名称：全局唯一，如 `blog-veweiyi`
- 存储区域：选择离用户最近的区域
- 访问控制：公开空间（博客图片）/ 私有空间（敏感文件）

### 2. 绑定自定义域名

**绑定步骤**
```
1. 准备一个已备案的域名（如 static.veweiyi.cn）
2. 在七牛云控制台添加自定义域名
3. 在域名解析中添加 CNAME 记录
4. 等待配置生效（通常 10 分钟）
```

### 3. 配置 HTTPS

```
1. 上传 SSL 证书
2. 选择强制 HTTPS
3. 保存配置
```

### 4. 配置 CDN 加速

**配置建议**
- 缓存时间：图片 30 天，其他 7 天
- 防盗链：配置 Referer 白名单
- 访问控制：IP 黑白名单

### 1. 图片无法访问

**排查步骤**
1. 检查存储空间权限（公开/私有）
2. 检查防盗链配置
3. 检查域名 CNAME 解析
4. 检查 HTTPS 证书

### 2. 上传失败

**可能原因**：文件大小超限、存储空间不足、权限不足

**解决方法**：检查文件大小限制、检查存储空间余额、使用分片上传

### 3. 流量超额

**预防措施**

- ✅ 设置流量告警
- ✅ 启用 CDN 缓存
- ✅ 压缩图片大小
- ✅ 配置防盗链

### 4. 成本过高

**优化方案**

- ✅ 使用生命周期管理
- ✅ 删除无用文件
- ✅ 启用图片压缩
- ✅ 选择合适的存储类型

## 最佳实践

### 1. 文件命名规范

```
✅ 使用有意义的文件名
✅ 使用时间戳或 UUID 避免重名
✅ 使用目录分类管理

示例：
/images/2024/01/article-cover-uuid.jpg
/videos/2024/01/tutorial-uuid.mp4
```

### 2. 图片优化

- ✅ 上传前压缩图片
- ✅ 使用 WebP 格式
- ✅ 生成多种尺寸缩略图
- ✅ 启用渐进式加载

### 3. 安全建议

- ✅ 定期更换 AccessKey
- ✅ 使用临时凭证
- ✅ 启用访问日志
- ✅ 配置防盗链

## 参考资料

- [七牛云官方文档](https://developer.qiniu.com/)
- [阿里云 OSS 文档](https://help.aliyun.com/product/31815.html)
- [腾讯云 COS 文档](https://cloud.tencent.com/document/product/436)
