// 声明 proto 语法版本，固定值
syntax = "proto3";

// proto 包名
package permissionrpc;

// 生成 golang 代码后的包名
option go_package = "./permissionrpc";

/************** 通用消息 **************/
// 分页请求参数
message PageReq {
  int64 page = 1;      // 页码
  int64 page_size = 2; // 每页大小
  repeated string sorts = 3; // 排序字段
}

// 分页响应参数
message PageResp {
  int64 page = 1;      // 页码
  int64 page_size = 2; // 每页大小
  int64 total = 3;     // 总数
}

/************** API管理 **************/
message MenuMeta{
  string type = 11;// 菜单类型（0代表目录、1代表菜单、2代表按钮、3代表外链）
  string title = 12;// 菜单标题
  string icon = 13;// 菜单标题
  int64 rank = 14;// 菜单排序
  string perm = 15;// 权限标识
  string params = 16;// 路由参数(json)
  int64 keep_alive = 17;// 是否缓存
  int64 always_show = 18;// 是否一直显示菜单
  int64 is_hidden = 19;// 是否隐藏
  int64 is_disable = 20;// 是否禁用  0否 1是
}

message Api {
  int64 id = 1;// 主键id
  int64 parent_id = 2;// 分组id
  string path = 3;// api路径
  string name = 4;// api名称
  string method = 5;// api请求方法
  int64 traceable = 6;// 是否追溯操作记录 0需要，1是
  int64 is_disable = 7;// 是否禁用  0否 1是
  int64 created_at = 8;// 创建时间
  int64 updated_at = 9;// 更新时间
  repeated Api children = 10;
}

message AddApiReq {
  int64 id = 1;// 主键id
  int64 parent_id = 2;// 分组id
  string path = 3;// api路径
  string name = 4;// api名称
  string method = 5;// api请求方法
  int64 traceable = 6;// 是否追溯操作记录 0需要，1是
  int64 is_disable = 7;// 是否禁用  0否 1是
  repeated AddApiReq children = 10;
}

message AddApiResp {
  Api api = 1;
}

message UpdateApiReq {
  int64 id = 1;// 主键id
  int64 parent_id = 2;// 分组id
  string path = 3;// api路径
  string name = 4;// api名称
  string method = 5;// api请求方法
  int64 traceable = 6;// 是否追溯操作记录 0需要，1是
  int64 is_disable = 7;// 是否禁用  0否 1是
  repeated UpdateApiReq children = 10;
}

message UpdateApiResp {
  Api api = 1;
}

message DeletesApiReq {
  repeated int64 ids = 1; // id列表
}

message DeletesApiResp {
  int64 success_count = 1; // 成功数量
}

message FindApiListReq {
  string name = 2;// api名称
  string path = 3;// api路径
  string method = 4;// api请求方法
}

message FindApiListResp {
  PageResp pagination = 1; // 分页信息
  repeated Api list = 2;
}

message SyncApiListReq {
  repeated AddApiReq apis = 1;
}

message SyncApiListResp {
  int64 success_count = 1; // 成功数量
}

message CleanApiListReq {
}

message CleanApiListResp {
  int64 success_count = 1; // 成功数量
}

message FindAllApiReq {
}

message FindAllApiResp {
  repeated Api list = 1;
}

/************** 菜单管理 **************/
message Menu {
  int64 id = 1;// 主键
  int64 parent_id = 2;// 父id
  string path = 3;// 路由路径
  string name = 4;// 路由名称
  string component = 5;// 路由组件
  string redirect = 6;// 路由重定向
  int64 created_at = 7;// 创建时间
  int64 updated_at = 8;// 更新时间
  repeated Menu children = 10;
  MenuMeta meta = 11;
}

message AddMenuReq {
  int64 id = 1;// 主键
  int64 parent_id = 2;// 父id
  string path = 3;// 路由路径
  string name = 4;// 路由名称
  string component = 5;// 路由组件
  string redirect = 6;// 路由重定向
  repeated AddMenuReq children = 10;
  MenuMeta meta = 11;
}

message AddMenuResp {
  Menu menu = 1;
}

message UpdateMenuReq {
  int64 id = 1;// 主键
  int64 parent_id = 2;// 父id
  string path = 3;// 路由路径
  string name = 4;// 路由名称
  string component = 5;// 路由组件
  string redirect = 6;// 路由重定向
  MenuMeta meta = 11;
}

message UpdateMenuResp {
  Menu menu = 1;
}

message DeletesMenuReq {
  repeated int64 ids = 1; // id列表
}

message DeletesMenuResp {
  int64 success_count = 1; // 成功数量
}

message FindMenuListReq {
  string title = 2;// 菜单标题
  string name = 3;// 路由名字
}

message FindMenuListResp {
  PageResp pagination = 1; // 分页信息
  repeated Menu list = 2;
}

message SyncMenuListReq {
  repeated AddMenuReq menus = 1;
}

message SyncMenuListResp {
  int64 success_count = 1; // 成功数量
}

message CleanMenuListReq {
}

message CleanMenuListResp {
  int64 success_count = 1; // 成功数量
}

message FindAllMenuReq {
}

message FindAllMenuResp {
  repeated Menu list = 1;
}

/************** 角色管理 **************/
message Role {
  int64 id = 1;// 主键id
  int64 parent_id = 2;// 父角色id
  string role_key = 3;// 角色名
  string role_label = 4;// 角色标签
  string role_comment = 5;// 角色备注
  int64 is_disable = 6;// 是否禁用  0否 1是
  int64 is_default = 7;// 是否默认角色 0否 1是
  int64 created_at = 8;// 创建时间
  int64 updated_at = 9;// 更新时间
  repeated Role children = 10;
}

message AddRoleReq {
  int64 id = 1;// 主键id
  int64 parent_id = 2;// 父角色id
  string role_key = 3;// 角色名
  string role_label = 4;// 角色标签
  string role_comment = 5;// 角色备注
  int64 is_disable = 6;// 是否禁用  0否 1是
  int64 is_default = 7;// 是否默认角色 0否 1是
}

message AddRoleResp {
  Role role = 1;
}

message UpdateRoleReq {
  int64 id = 1;// 主键id
  int64 parent_id = 2;// 父角色id
  string role_key = 3;// 角色名
  string role_label = 4;// 角色标签
  string role_comment = 5;// 角色备注
  int64 is_disable = 6;// 是否禁用  0否 1是
  int64 is_default = 7;// 是否默认角色 0否 1是
}

message UpdateRoleResp {
  Role role = 1;
}

message DeletesRoleReq {
  repeated int64 ids = 1; // id列表
}

message DeletesRoleResp {
  int64 success_count = 1; // 成功数量
}

message FindRoleListReq {
  PageReq paginate = 1;    // 分页参数
  string role_key = 2;// 角色名
  string role_label = 3;// 角色标签
  int64 is_disable = 4;// 是否禁用  0否 1是
}

message FindRoleListResp {
  PageResp pagination = 1; // 分页信息
  repeated Role list = 2;
}

message FindAllRoleReq {
}

message FindAllRoleResp {
  repeated Role list = 1;
}

message UpdateRoleMenusReq {
  int64 role_id = 1;
  repeated int64 menu_ids = 2;
}

message UpdateRoleMenusResp {
}

message UpdateRoleApisReq {
  int64 role_id = 1;
  repeated int64 api_ids = 2;
}

message UpdateRoleApisResp {
}

message FindRoleResourcesReq {
  int64 id = 1; // 角色id
}

message FindRoleResourcesResp {
  int64 role_id = 1;
  repeated int64 api_ids = 2;
  repeated int64 menu_ids = 3;
}

message UpdateUserRoleReq {
  string user_id = 1; // 用户id
  repeated int64 role_ids = 2;
}

message UpdateUserRoleResp {
}

message FindUserApisReq {
  string user_id = 1; // 用户id
}

message FindUserApisResp {
  repeated Api list = 1;
}

message FindUserMenusReq {
  string user_id = 1; // 用户id
}

message FindUserMenusResp {
  repeated Menu list = 1;
}

message FindUserRolesReq {
  string user_id = 1; // 用户id
}

message FindUserRolesResp {
  repeated Role list = 1;
}

service PermissionRpc {
  // 创建接口
  rpc AddApi(AddApiReq) returns(AddApiResp);
  // 更新接口
  rpc UpdateApi(UpdateApiReq) returns(UpdateApiResp);
  // 删除接口
  rpc DeletesApi(DeletesApiReq) returns(DeletesApiResp);
  // 查询接口列表
  rpc FindApiList(FindApiListReq) returns(FindApiListResp);
  // 同步接口列表
  rpc SyncApiList(SyncApiListReq) returns(SyncApiListResp);
  // 清空接口列表
  rpc CleanApiList(CleanApiListReq) returns(CleanApiListResp);
  // 查找所有接口
  rpc FindAllApi(FindAllApiReq) returns(FindAllApiResp);

  // 创建菜单
  rpc AddMenu(AddMenuReq) returns(AddMenuResp);
  // 更新菜单
  rpc UpdateMenu(UpdateMenuReq) returns(UpdateMenuResp);
  // 删除菜单
  rpc DeletesMenu(DeletesMenuReq) returns(DeletesMenuResp);
  // 查询菜单列表
  rpc FindMenuList(FindMenuListReq) returns(FindMenuListResp);
  // 同步菜单列表
  rpc SyncMenuList(SyncMenuListReq) returns(SyncMenuListResp);
  // 清空菜单列表
  rpc CleanMenuList(CleanMenuListReq) returns(CleanMenuListResp);
  // 查找所有菜单
  rpc FindAllMenu(FindAllMenuReq) returns(FindAllMenuResp);

  // 创建角色
  rpc AddRole(AddRoleReq) returns(AddRoleResp);
  // 更新角色
  rpc UpdateRole(UpdateRoleReq) returns(UpdateRoleResp);
  // 删除角色
  rpc DeletesRole(DeletesRoleReq) returns(DeletesRoleResp);
  // 查询角色列表
  rpc FindRoleList(FindRoleListReq) returns(FindRoleListResp);
  // 查询所有角色
  rpc FindAllRole(FindAllRoleReq) returns(FindAllRoleResp);

  // 更新角色菜单
  rpc UpdateRoleMenus(UpdateRoleMenusReq) returns(UpdateRoleMenusResp);
  // 更新角色资源
  rpc UpdateRoleApis(UpdateRoleApisReq) returns(UpdateRoleApisResp);
  // 查询角色资源权限
  rpc FindRoleResources(FindRoleResourcesReq) returns(FindRoleResourcesResp);

  // 修改用户角色
  rpc UpdateUserRole(UpdateUserRoleReq) returns(UpdateUserRoleResp);
  // 获取用户接口权限
  rpc FindUserApis(FindUserApisReq) returns(FindUserApisResp);
  // 获取用户菜单权限
  rpc FindUserMenus(FindUserMenusReq) returns(FindUserMenusResp);
  // 获取用户角色信息
  rpc FindUserRoles(FindUserRolesReq) returns(FindUserRolesResp);
}
