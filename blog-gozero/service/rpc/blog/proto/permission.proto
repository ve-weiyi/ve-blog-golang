// 声明 proto 语法版本，固定值
syntax = "proto3";

// proto 包名
package permissionrpc;

// 生成 golang 代码后的包名
option go_package = "./permissionrpc";

//==================== 通用消息 ====================
message EmptyResp {
}

message IdReq {
  int64 id = 1;
}
message IdsReq {
  repeated int64 ids = 1;
}

message BatchResp {
  int64 success_count = 1;
}

message UserIdReq {
  string user_id = 1;
}

// 分页请求
message PageReq {
  int64 page = 1;      // 页码
  int64 page_size = 2; // 每页大小
  repeated string sorts = 3; // 排序字段
}

// 分页响应
message PageResp {
  int64 page = 1;      // 页码
  int64 page_size = 2; // 每页大小
  int64 total = 3;     // 总数
}

/************** rbac 权限相关 **************/
message NewApiReq {
  int64 id = 1;// 主键id
  int64 parent_id = 2;// 分组id
  string path = 3;// api路径
  string name = 4;// api名称
  string method = 5;// api请求方法
  int64 traceable = 6;// 是否追溯操作记录 0需要，1是
  int64 is_disable = 7;// 是否禁用  0否 1是
  repeated NewApiReq children = 10;
}

message ApiDetailsResp {
  int64 id = 1;// 主键id
  int64 parent_id = 2;// 分组id
  string path = 3;// api路径
  string name = 4;// api名称
  string method = 5;// api请求方法
  int64 traceable = 6;// 是否追溯操作记录 0需要，1是
  int64 is_disable = 7;// 是否禁用  0否 1是
  int64 created_at = 8;// 创建时间
  int64 updated_at = 9;// 更新时间
  repeated ApiDetailsResp children = 10;
}

message FindApiListResp {
  PageResp pagination = 1; // 分页信息
  repeated ApiDetailsResp list = 2;
}

message NewMenuReq {
  int64 id = 1;// 主键
  int64 parent_id = 2;// 父id
  string path = 3;// 路由路径
  string name = 4;// 路由名称
  string component = 5;// 路由组件
  string redirect = 6;// 路由重定向
  repeated NewMenuReq children = 10;
  MenuMeta meta = 11;
}

message MenuMeta{
  string type = 11;// 菜单类型（0代表目录、1代表菜单、2代表按钮、3代表外链）
  string title = 12;// 菜单标题
  string icon = 13;// 菜单标题
  int64 rank = 14;// 菜单排序
  string perm = 15;// 权限标识
  string params = 16;// 路由参数(json)
  int64 keep_alive = 17;// 是否缓存
  int64 always_show = 18;// 是否一直显示菜单
  int64 is_hidden = 19;// 是否隐藏
  int64 is_disable = 20;// 是否禁用  0否 1是
}

message MenuDetailsResp {
  int64 id = 1;// 主键
  int64 parent_id = 2;// 父id
  string path = 3;// 路由路径
  string name = 4;// 路由名称
  string component = 5;// 路由组件
  string redirect = 6;// 路由重定向
  int64 created_at = 7;// 创建时间
  int64 updated_at = 8;// 更新时间
  repeated MenuDetailsResp children = 10;
  MenuMeta meta = 11;
}

message FindMenuListResp {
  PageResp pagination = 1; // 分页信息
  repeated MenuDetailsResp list = 2;
}

message SyncMenuListReq {
  repeated NewMenuReq menus = 1;
}

message SyncApiListReq {
  repeated NewApiReq apis = 1;
}

message CleanApiListReq {
}

message FindAllApiReq {
}

message NewRoleReq {
  int64 id = 1;// 主键id
  int64 parent_id = 2;// 父角色id
  string role_key = 3;// 角色名
  string role_label = 4;// 角色标签
  string role_comment = 5;// 角色备注
  int64 is_disable = 6;// 是否禁用  0否 1是
  int64 is_default = 7;// 是否默认角色 0否 1是
  //  int64 created_at = 8;// 创建时间
  //  int64 updated_at = 9;// 更新时间
}

message RoleDetailsResp {
  int64 id = 1;// 主键id
  int64 parent_id = 2;// 父角色id
  string role_key = 3;// 角色名
  string role_label = 4;// 角色标签
  string role_comment = 5;// 角色备注
  int64 is_disable = 6;// 是否禁用  0否 1是
  int64 is_default = 7;// 是否默认角色 0否 1是
  int64 created_at = 8;// 创建时间
  int64 updated_at = 9;// 更新时间
  repeated RoleDetailsResp children = 10;
}

message FindRoleListResp {
  PageResp pagination = 1; // 分页信息
  repeated RoleDetailsResp list = 2;
}

message RoleResourcesResp {
  int64 role_id = 1;
  repeated int64 api_ids = 2;
  repeated int64 menu_ids = 3;
}

message UpdateRoleApisReq {
  int64 role_id = 1;
  repeated int64 api_ids = 2;
}

message UpdateRoleMenusReq {
  int64 role_id = 1;
  repeated int64 menu_ids = 2;
}

message UpdateUserRoleReq {
  string user_id = 1; // 用户id
  repeated int64 role_ids = 2;
}

message FindApiListReq {
  string name = 2;// api名称
  string path = 3;// api路径
  string method = 4;// api请求方法
}

message FindMenuListReq {
  string title = 2;// 菜单标题
  string name = 3;// 路由名字
}

message FindRoleListReq {
  PageReq paginate = 1;    // 分页参数
  string role_key = 2;// 角色名
  string role_label = 3;// 角色标签
  int64 is_disable = 4;// 是否禁用  0否 1是
}

message FindAllRoleReq {
}

message CleanMenuListReq {
}

message FindAllMenuReq {
}

service PermissionRpc {
  // 创建接口
  rpc AddApi(NewApiReq) returns(ApiDetailsResp);
  // 更新接口
  rpc UpdateApi(NewApiReq) returns(ApiDetailsResp);
  // 删除接口
  rpc DeletesApi(IdsReq) returns(BatchResp);
  // 查询接口列表
  rpc FindApiList(FindApiListReq) returns(FindApiListResp);
  // 同步接口列表
  rpc SyncApiList(SyncApiListReq) returns(BatchResp);
  // 清空接口列表
  rpc CleanApiList(CleanApiListReq) returns(BatchResp);
  // 查找所有接口
  rpc FindAllApi(FindAllApiReq) returns(FindApiListResp);

  // 创建菜单
  rpc AddMenu(NewMenuReq) returns(MenuDetailsResp);
  // 更新菜单
  rpc UpdateMenu(NewMenuReq) returns(MenuDetailsResp);
  // 删除菜单
  rpc DeletesMenu(IdsReq) returns(BatchResp);
  // 查询菜单列表
  rpc FindMenuList(FindMenuListReq) returns(FindMenuListResp);
  // 同步菜单列表
  rpc SyncMenuList(SyncMenuListReq) returns(BatchResp);
  // 清空菜单列表
  rpc CleanMenuList(CleanMenuListReq) returns(BatchResp);
  // 查找所有菜单
  rpc FindAllMenu(FindAllMenuReq) returns(FindMenuListResp);


  // 创建角色
  rpc AddRole(NewRoleReq) returns(RoleDetailsResp);
  // 更新角色
  rpc UpdateRole(NewRoleReq) returns(RoleDetailsResp);
  // 删除角色
  rpc DeletesRole(IdsReq) returns(BatchResp);
  // 查询角色列表
  rpc FindRoleList(FindRoleListReq) returns(FindRoleListResp);
  // 查询所有角色
  rpc FindAllRole(FindAllRoleReq) returns(FindRoleListResp);

  // 更新角色菜单
  rpc UpdateRoleMenus(UpdateRoleMenusReq) returns(EmptyResp);
  // 更新角色资源
  rpc UpdateRoleApis(UpdateRoleApisReq) returns(EmptyResp);
  // 查询角色资源权限
  rpc FindRoleResources(IdReq) returns(RoleResourcesResp);

  // 修改用户角色
  rpc UpdateUserRole(UpdateUserRoleReq) returns(EmptyResp);
  // 获取用户接口权限
  rpc FindUserApis(UserIdReq) returns(FindApiListResp);
  // 获取用户菜单权限
  rpc FindUserMenus(UserIdReq) returns(FindMenuListResp);
  // 获取用户角色信息
  rpc FindUserRoles(UserIdReq) returns(FindRoleListResp);
}
