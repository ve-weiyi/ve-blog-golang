// 声明 proto 语法版本，固定值
syntax = "proto3";

// proto 包名
package account;

// 生成 golang 代码后的包名
option go_package = "./account";

import "any.proto";

message EmptyReq {
}

message EmptyResp {
}

message IdReq {
  int64 id = 1;
}

message IdsReq {
  repeated int64 ids = 1;
}

message PageQuery {
  PageLimit limit = 1;
  repeated PageSort sorts = 2;// 排序
  repeated PageCondition conditions = 3;// 使用条件语句查询
}

message PageLimit {
  int64 page = 1;
  int64 pageSize = 2;
}

message PageSort {
  string field = 1;
  string order = 2;
}

message PageCondition {
  string field = 1;
  string value = 2;
  string logic = 3;
  string operator = 4;
}

message PageResult {
  int64 page = 1;
  int64 page_size = 2;
  int64 total = 3;
}

message BatchResult {
  int64 success_count = 1;
}

/************** account 账号相关 **************/

message LoginReq {
  string username = 1;
  string password = 2;
  string code = 3;
}

message LoginResp {
  int64 user_id = 1;// 用户id
  string username = 2;// 用户名
  string nickname = 3;// 昵称
  string avatar = 4;// 头像
  string intro = 5;// 个人简介
  string website = 6;// 个人网站
  string email = 7;// 邮箱
  repeated RoleDTO roles = 8;// 角色列表
}

message RoleDTO {
  string role_name = 1;
  string role_comment = 2;
}

message OauthLoginReq {
  string platform = 1;// 平台
  string code = 2;// 授权码
  string state = 3;// 状态
}

message OauthLoginUrlResp {
  string url = 1;// 授权地址
}

message ResetPasswordReq {
  string username = 1;
  string password = 2;
  string code = 3;
}

message UserEmailReq {
  string username = 1;
}

service AccountRpc {
  // 登录
  rpc Login(LoginReq) returns(LoginResp);
  // 登出
  rpc Logout(EmptyReq) returns(EmptyResp);
  // 注销
  rpc Logoff(EmptyReq) returns(EmptyResp);
  // 注册
  rpc Register(LoginReq) returns(EmptyResp);
  // 发送注册邮件
  rpc RegisterEmail(UserEmailReq) returns(EmptyResp);
  // 发送忘记密码邮件
  rpc ForgetPasswordEmail(UserEmailReq) returns(EmptyResp);
  // 重置密码
  rpc ResetPassword(ResetPasswordReq) returns(EmptyResp);
  // 第三方登录
  rpc OauthLogin(OauthLoginReq) returns(LoginResp);
  // 获取授权地址
  rpc GetOauthAuthorizeUrl(OauthLoginReq) returns(OauthLoginUrlResp);
}

/************** rbac 权限相关 **************/
message Api {
  int64 id = 1;// 主键id
  string name = 2;// api名称
  string path = 3;// api路径
  string method = 4;// api请求方法
  int64 parent_id = 5;// 分组id
  int64 traceable = 6;// 是否追溯操作记录 0需要，1是
  int64 status = 7;// 状态 1开，2关
  int64 created_at = 8;// 创建时间
  int64 updated_at = 9;// 更新时间
}

message ApiDetailsDTO {
  int64 id = 1;// 主键id
  string name = 2;// api名称
  string path = 3;// api路径
  string method = 4;// api请求方法
  int64 parent_id = 5;// 分组id
  int64 traceable = 6;// 是否追溯操作记录 0需要，1是
  int64 status = 7;// 状态 1开，2关
  int64 created_at = 8;// 创建时间
  int64 updated_at = 9;// 更新时间
  repeated ApiDetailsDTO children = 10;
}

message ApiPageResp {
  int64 total = 1;
  repeated ApiDetailsDTO list = 2;
}

service apiRpc {
  // 创建接口
  rpc CreateApi(Api) returns(Api);
  // 更新接口
  rpc UpdateApi(Api) returns(Api);
  // 删除接口
  rpc DeleteApi(IdReq) returns(BatchResult);
  // 批量删除接口
  rpc DeleteApiList(IdsReq) returns(BatchResult);
  // 查询接口
  rpc FindApi(IdReq) returns(Api);
  // 分页获取接口列表
  rpc FindApiList(PageQuery) returns(ApiPageResp);
  // 同步接口列表
  rpc SyncApiList(EmptyReq) returns(BatchResult);
  // 清空接口列表
  rpc CleanApiList(EmptyReq) returns(EmptyResp);
}

message Menu {
  int64 id = 1;// 主键
  int64 parent_id = 2;// 父id
  string title = 3;// 菜单标题
  string path = 4;// 路由路径
  string name = 5;// 路由名称
  string component = 6;// 路由组件
  string redirect = 7;// 路由重定向
  int64 type = 8;// 菜单类型
  string extra = 9;// 菜单元数据
  int64 created_at = 10;// 创建时间
  int64 updated_at = 11;// 更新时间
}

message MenuDetailsDTO {
  int64 id = 1;// 主键
  int64 parent_id = 2;// 父id
  string title = 3;// 菜单标题
  int64 type = 4;// 菜单类型（0代表菜单、1代表iframe、2代表外链、3代表按钮）
  string path = 5;// 路由地址
  string name = 6;// 路由名字
  string component = 7;// Layout组件
  string redirect = 8;// 路由重定向
  string extra = 9;// 额外的配置信息
  int64 created_at = 10;// 创建时间
  int64 updated_at = 11;// 更新时间
  repeated MenuDetailsDTO children = 12;
}

message MenuPageResp {
  int64 total = 1;
  repeated MenuDetailsDTO list = 2;
}

message SyncMenuRequest {
  repeated MenuDetailsDTO menus = 1;
}

service menuRpc {
  // 创建菜单
  rpc CreateMenu(Menu) returns(Menu);
  // 更新菜单
  rpc UpdateMenu(Menu) returns(Menu);
  // 删除菜单
  rpc DeleteMenu(IdReq) returns(BatchResult);
  // 批量删除菜单
  rpc DeleteMenuList(IdsReq) returns(BatchResult);
  // 查询菜单
  rpc FindMenu(IdReq) returns(Menu);
  // 分页获取菜单列表
  rpc FindMenuList(PageQuery) returns(MenuPageResp);
  // 同步菜单列表
  rpc SyncMenuList(SyncMenuRequest) returns(BatchResult);
  // 清空菜单列表
  rpc CleanMenuList(EmptyReq) returns(EmptyResp);
}

message Role {
  int64 id = 1;// 主键id
  int64 parent_id = 2;// 父角色id
  string role_domain = 3;// 角色域
  string role_name = 4;// 角色名
  string role_comment = 5;// 角色备注
  int64 is_disable = 6;// 是否禁用  0否 1是
  int64 is_default = 7;// 是否默认角色 0否 1是
  int64 created_at = 8;// 创建时间
  int64 updated_at = 9;// 更新时间
}

message RoleDetailsDTO {
  int64 id = 1;// 主键id
  int64 parent_id = 2;// 父角色id
  string role_domain = 3;// 角色域
  string role_name = 4;// 角色名
  string role_comment = 5;// 角色备注
  int64 is_disable = 6;// 是否禁用  0否 1是
  int64 is_default = 7;// 是否默认角色 0否 1是
  int64 created_at = 8;// 创建时间
  int64 updated_at = 9;// 更新时间
  repeated RoleDetailsDTO children = 10;
}

message RolePageResp {
  int64 total = 1;
  repeated RoleDetailsDTO list = 2;
}

message RoleResourcesResp {
  int64 role_id = 1;
  repeated int64 menu_id_list = 2;
  repeated int64 api_id_list = 3;
}

message UpdateRoleApisReq {
  int64 role_id = 1;
  repeated int64 api_ids = 2;
}

message UpdateRoleMenusReq {
  int64 role_id = 1;
  repeated int64 menu_ids = 2;
}

service roleRpc {
  // 创建角色
  rpc CreateRole(Role) returns(Role);
  // 更新角色
  rpc UpdateRole(Role) returns(Role);
  // 删除角色
  rpc DeleteRole(IdReq) returns(BatchResult);
  // 批量删除角色
  rpc DeleteRoleList(IdsReq) returns(BatchResult);
  // 查询角色
  rpc FindRole(IdReq) returns(Role);
  // 分页获取角色列表
  rpc FindRoleList(PageQuery) returns(RolePageResp);
  // 查询角色
  rpc FindRoleResources(IdReq) returns(RoleResourcesResp);
  // 更新角色菜单
  rpc UpdateRoleMenus(UpdateRoleMenusReq) returns(EmptyResp);
  // 更新角色资源
  rpc UpdateRoleApis(UpdateRoleApisReq) returns(EmptyResp);
}

message LoginHistory {
  int64 id = 1;
  string login_type = 2;// 登录类型
  string agent = 3;// 代理
  string ip_address = 4;// ip host
  string ip_source = 5;// ip 源
  string login_time = 6;// 创建时间
}

message LoginHistoryPageResp {
  int64 total = 1;
  repeated LoginHistory list = 2;
}

message UserInfoReq {
  string nickname = 1;// 昵称
  string website = 2;// 网站
  string intro = 3;// 简介
  string avatar = 4;// 头像
}

message UserInfoResp {
  int64 id = 1;// id
  int64 user_id = 2;// 用户id
  string email = 3;// 用户邮箱
  string nickname = 4;// 用户昵称
  string avatar = 5;// 用户头像
  string phone = 6;// 用户手机号
  string intro = 7;// 个人简介
  string website = 8;// 个人网站
  int64 created_at = 9;// 创建时间
  int64 updated_at = 10;// 更新时间
}

service userRpc {
  // 查询用户登录历史
  rpc FindUserLoginHistoryList(PageQuery) returns(LoginHistoryPageResp);
  // 批量删除登录历史
  rpc DeleteUserLoginHistoryList(IdsReq) returns(EmptyResp);
  // 获取用户接口权限
  rpc GetUserApis(EmptyReq) returns(ApiPageResp);
  // 获取用户菜单权限
  rpc GetUserMenus(EmptyReq) returns(MenuPageResp);
  // 获取用户角色信息
  rpc GetUserRoles(EmptyReq) returns(RolePageResp);
  // 获取用户信息
  rpc GetUserInfo(EmptyReq) returns(UserInfoResp);
  // 修改用户信息
  rpc UpdateUserInfo(UserInfoReq) returns(UserInfoResp);
  // 更换用户头像
  rpc UpdateUserAvatar(EmptyReq) returns(UserInfoResp);
}
