# Gin 博客项目

## 项目简介

基于 Gin 框架开发的博客系统，采用分层架构设计，包含完整的博客功能模块。提供 `api` 和 `migrate` 两个命令，分别用于启动服务和初始化数据库。

## 项目结构

```
blog-gin/
├── api/                # API模块目录
│   ├── admin/          # 管理平台API模块
│   └── blog/           # 博客平台API模块
│       ├── handler/    # 请求处理器
│       ├── logic/      # 业务逻辑层
│       ├── router/     # 路由定义
│       └── types/      # 类型定义
├── cmd/                # 启动命令目录
│   ├── api.go          # API服务启动命令
│   ├── migrate.go      # 数据库迁移命令
│   └── root.go         # 根命令
├── config/             # 配置管理
├── docs/               # Swagger 文档
├── infra/              # 基础设施
│   ├── middleware/     # HTTP 中间件
│   ├── request/        # 请求处理
│   └── response/       # 响应封装
├── initialize/         # 初始化逻辑目录
├── svctx/              # 服务上下文目录
├── config.default.yaml # 默认配置文件
└── main.go             # 应用入口文件
```

## 环境要求

- Go 1.20+
- MySQL 8.0+
- Redis 6.0+
- RabbitMQ 3.8+ (可选)
- Nacos (可选，开发环境可使用本地配置)

## 快速开始

### 1. 安装依赖

```bash
make deps
```

### 2. 配置文件

```bash
# 复制默认配置
cp config.default.yaml config.yaml

# 修改数据库、Redis 等连接信息
vim config.yaml
```

### 3. 初始化数据库

```bash
# 方式一：使用 migrate 命令（会删除并重建数据库）
go run main.go migrate

# 方式二：手动执行 SQL 文件（推荐）
mysql -u root -p < blog-veweiyi-init.sql
mysql -u root -p < blog-veweiyi-data.sql
```

### 4. 启动服务

**方式一：使用 Makefile（推荐）**

```bash
make run
```

**方式二：直接运行**

```bash
# 使用本地配置文件
go run main.go api -c file -f ./config.yaml

# 使用默认配置
go run main.go api
```

### 5. 访问服务

- API 文档：http://localhost:8080/api/v1/swagger/index.html
- 健康检查：http://localhost:8080/api/v1/version

## 命令详解

### API 服务命令

启动博客 HTTP API 服务，支持本地配置文件和 Nacos 配置中心。

**基本用法**

```bash
go run main.go api [flags]
```

**参数说明**

| 参数               | 说明                  | 默认值            |
|------------------|---------------------|----------------|
| `-c, --config`   | 配置读取方式 (file/nacos) | file           |
| `-f, --filepath` | 本地配置文件路径            | config.yaml    |
| `--n-host`       | Nacos 服务器地址         | veweiyi.cn     |
| `--n-port`       | Nacos 服务器端口         | 8848           |
| `--n-namespace`  | Nacos 命名空间          | dev            |
| `--n-data-id`    | Nacos 配置 DataId     | ve-blog-golang |
| `--n-group`      | Nacos 配置分组          | blog           |
| `--n-user`       | Nacos 用户名           | nacos          |
| `--n-password`   | Nacos 密码            | nacos          |

**使用示例**

```bash
# 开发环境
go run main.go api -c file -f ./config.yaml

# 生产环境（Nacos）
go run main.go api -c nacos --n-namespace prod --n-host nacos.prod.com
```

### 数据库迁移命令

初始化数据库，包括创建数据库、执行表结构 SQL 和导入初始数据。

⚠️ **警告**：此命令会删除并重建数据库，请谨慎使用！

**基本用法**

```bash
go run main.go migrate [flags]
```

**参数说明**

| 参数           | 说明               | 默认值                                      |
|--------------|------------------|------------------------------------------|
| `-i, --file` | 数据库结构 SQL 文件路径   | blog-veweiyi-init.sql                    |
| `-d, --data` | 数据库初始数据 SQL 文件路径 | blog-veweiyi-data.sql                    |
| `--host`     | 数据库主机地址          | localhost                                |
| `--port`     | 数据库端口            | 3306                                     |
| `--username` | 数据库用户名           | root                                     |
| `--password` | 数据库密码            | 123456                                   |
| `--name`     | 数据库名称            | blog-veweiyi                             |
| `--config`   | 数据库连接配置          | charset=utf8mb4&parseTime=True&loc=Local |

**使用示例**

```bash
# 使用默认配置
go run main.go migrate

# 指定数据库连接
go run main.go migrate --host 192.168.1.100 --username admin --password admin123

# 只执行表结构，不导入数据
go run main.go migrate -i blog-veweiyi-init.sql -d ""
```

## 常用命令

```bash
make help         # 查看所有可用命令
make deps         # 安装依赖
make run          # 启动服务
make build        # 编译服务
make swagger      # 生成 Swagger 文档
make swagger-fmt  # 格式化 Swagger 注解
make fmt          # 格式化代码
make clean        # 清理编译文件
```

## 编译部署

### 编译服务

```bash
make build
```

编译后的可执行文件位于 `bin/blog-gin`

### 运行编译后的服务

```bash
# 使用本地配置
./bin/blog-gin api -c file -f ./config.yaml

# 使用 Nacos 配置
./bin/blog-gin api -c nacos --n-namespace prod
```

## 注意事项

1. 确保依赖服务（MySQL、Redis）正常运行
2. `migrate` 命令会删除并重建数据库，生产环境请手动执行 SQL 文件
3. 开发环境使用本地配置文件，生产环境建议使用 Nacos 配置中心
4. 数据库用户需要有 DROP、CREATE 权限才能执行 migrate 命令
